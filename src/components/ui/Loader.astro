---
import delionLogo from '../../assets/images/index/delion-logo.svg';
---

<div id="loader" class="fixed inset-0 z-[9999] bg-[#00142C] flex items-center justify-center transition-opacity duration-500">
  <div class="relative flex flex-col items-center" data-aos="fade-in" data-aos-duration="1000">
    <div class="w-auto h-24 relative animate-pulse-custom">
      <img src={delionLogo.src} alt="Delion Loader" class="h-full w-auto object-contain" />
    </div>
    <div class="mt-4 flex gap-2">
      <div class="w-3 h-3 rounded-full bg-[#0044FF] animate-bounce delay-0"></div>
      <div class="w-3 h-3 rounded-full bg-[#00E0FF] animate-bounce delay-150"></div>
      <div class="w-3 h-3 rounded-full bg-[#020B26] animate-bounce delay-300"></div>
    </div>
  </div>
</div>

<style>
  /* Animación personalizada para el logo */
  @keyframes pulse-custom {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.8; }
  }
  .animate-pulse-custom {
    animation: pulse-custom 2s infinite ease-in-out;
  }

  /* Clases para ocultar el loader */
  .loader-hidden {
    opacity: 0;
    pointer-events: none;
  }
</style>

<script>
  import AOS from "aos";

  // Lógica del loader
  document.addEventListener('DOMContentLoaded', () => {
    // Inicializar AOS si no se ha hecho ya, con fallback
    try {
      AOS.init();
    } catch (error) {
      console.warn('AOS init failed in loader, applying fallback visibility', error);
      document.querySelectorAll('[data-aos]').forEach(el => {
        (el as HTMLElement).style.opacity = '1';
        (el as HTMLElement).style.transform = 'none';
      });
    }

    const loader = document.getElementById('loader');
    
    if (loader) {
      // Ocultar loader después de que la página haya cargado
      window.addEventListener('load', () => {
        setTimeout(() => {
          loader.classList.add('loader-hidden');
        }, 1000); // Retraso mínimo de 1s para visualización
      });

      // Manejar transiciones de vista (si se usa View Transitions API o navegación SPA simulada)
      document.addEventListener('astro:before-preparation', () => {
        loader.classList.remove('loader-hidden');
      });

      document.addEventListener('astro:after-swap', () => {
        setTimeout(() => {
          loader.classList.add('loader-hidden');
        }, 500);
      });
    }
  });
</script>